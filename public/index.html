<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Cập nhật viewport: Chặn zoom (user-scalable=no) để tạo cảm giác giống App native -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    
    <!-- Màu thanh trạng thái trình duyệt trên mobile (trùng với màu nền app) -->
    <meta name="theme-color" content="#0f172a" />
    <meta name="description" content="Level up your English skills in this RPG gamified learning app." />

    <!-- ====================================================== -->
    <!-- KỸ THUẬT PRELOAD (TẢI TRƯỚC) -->
    <!-- Giúp tải ảnh nền ngay lập tức để tránh bị hiện màn hình xanh quá lâu -->
    <!-- ====================================================== -->
    <link rel="preload" as="image" href="/bg-loading.jpeg" />

    <!-- ====================================================== -->
    <!-- PWA CONFIGURATION (CẤU HÌNH CÀI ĐẶT APP) -->
    <!-- ====================================================== -->
    <!-- 1. File Manifest chứa thông tin app -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- 2. Icon hiển thị trên tab và màn hình chính -->
    <link rel="icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/logo192.png" />
    
    <!-- 3. Cấu hình riêng cho iOS (iPhone/iPad) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EngLeveling">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <title>English Leveling RPG</title>

    <!-- ====================================================== -->
    <!-- START: TẢI FONT CHỮ LILITA ONE TOÀN CỤC -->
    <!-- ====================================================== -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet">
    <!-- ====================================================== -->
    <!-- END: TẢI FONT TOÀN CỤC -->
    <!-- ====================================================== -->

    <!-- ====================================================== -->
    <!-- LINK FILE CSS LOADING RIÊNG BIỆT -->
    <!-- Chứa style cho màn hình chờ và ảnh nền -->
    <!-- ====================================================== -->
    <link rel="stylesheet" href="/loading.css" />

  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    
    <!-- 
      1. CONTAINER CỦA REACT APP
      React sẽ render giao diện game vào đây.
      Nó nằm bên dưới màn hình Loading nên người dùng sẽ không thấy 
      cho đến khi Loading biến mất.
    -->
    <div id="root"></div>

    <!-- 
      2. MÀN HÌNH LOADING (ĐÃ ĐƯA RA NGOÀI ROOT)
      Nó có z-index: 9999 (trong file loading.css) nên sẽ luôn phủ lên trên App React.
      Thêm id="global-loader" để JavaScript có thể tìm và xóa nó sau 3s.
    -->
    <div id="global-loader" class="app-loading">
      <div class="loading-spinner"></div>
      <div class="loading-text">LOADING RPG...</div>
    </div>

    <!-- 
      3. SCRIPT XỬ LÝ DELAY 3 GIÂY
      Đoạn mã này đảm bảo màn hình Loading hiện ít nhất 3 giây mới tắt.
    -->
    <script>
      // Lắng nghe sự kiện khi toàn bộ trang (bao gồm ảnh, script) tải xong
      window.addEventListener('load', () => {
        
        // Thời gian chờ tối thiểu (3000ms = 3 giây)
        const MIN_WAIT_TIME = 3000; 

        // Hàm xóa loading
        const removeLoader = () => {
          const loader = document.getElementById('global-loader');
          if (loader) {
            // Thêm hiệu ứng mờ dần (Fade Out) trong 0.5s cho mượt mà
            loader.style.transition = 'opacity 0.5s ease';
            loader.style.opacity = '0';

            // Sau khi hiệu ứng mờ kết thúc (0.5s), mới xóa hẳn phần tử khỏi HTML
            // Để người dùng có thể thao tác (click/touch) vào App bên dưới
            setTimeout(() => {
              loader.remove();
            }, 500);
          }
        };

        // Kích hoạt bộ đếm thời gian
        setTimeout(removeLoader, MIN_WAIT_TIME);
      });
    </script>

    <!-- ====================================================== -->
    <!-- SCRIPT QUAN TRỌNG: BẮT SỰ KIỆN CÀI ĐẶT & SERVICE WORKER -->
    <!-- ====================================================== -->
    <script>
      // 1. Khởi tạo biến toàn cục để lưu sự kiện cài đặt
      window.deferredPrompt = null;

      // 2. Lắng nghe sự kiện ngay lập tức khi trang tải
      window.addEventListener('beforeinstallprompt', (e) => {
        // Ngăn Chrome hiển thị thanh thông báo cài đặt mặc định bên dưới màn hình
        e.preventDefault();
        
        // Lưu sự kiện lại vào biến window để React Component (profile.tsx) dùng sau
        window.deferredPrompt = e;
        
        console.log('✅ PWA Install Prompt captured successfully in index.html');
      });

      // 3. Đăng ký Service Worker (Bắt buộc cho PWA)
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, function(err) {
            console.log('ServiceWorker registration failed: ', err);
          });
        });
      }
    </script>
  </body>
</html>
